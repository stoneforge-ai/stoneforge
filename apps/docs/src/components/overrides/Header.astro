---
import type { Props } from '@astrojs/starlight/props';
import Default from '@astrojs/starlight/components/Header.astro';
---

<div class="sf-header-wrap">
  <Default {...Astro.props}><slot /></Default>
</div>

<style>
  .sf-header-wrap :global(header.header) {
    background: var(--sl-color-bg-nav);
    backdrop-filter: blur(20px) saturate(1.5);
    -webkit-backdrop-filter: blur(20px) saturate(1.5);
    border-bottom: 1px solid var(--sl-color-hairline);
    transition: box-shadow 0.3s ease;
  }

  /* Dynamic shadow when scrolled */
  .sf-header-wrap.scrolled :global(header.header) {
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
  }

  :global([data-theme='light']) .sf-header-wrap.scrolled :global(header.header) {
    box-shadow: 0 2px 12px rgba(15, 23, 42, 0.06);
  }

  /* Scroll progress bar */
  .sf-header-wrap {
    position: relative;
  }

  .sf-header-wrap::after {
    content: '';
    position: fixed;
    top: var(--sl-nav-height);
    left: 0;
    width: var(--sf-scroll-progress, 0%);
    height: 2px;
    background: linear-gradient(to right, #60a5fa, #a78bfa);
    box-shadow: 0 0 8px rgba(96, 165, 250, 0.3);
    z-index: 100;
    transition: width 50ms linear;
  }

  :global([data-theme='light']) .sf-header-wrap::after {
    background: linear-gradient(to right, #2563eb, #7c3aed);
    box-shadow: 0 0 8px rgba(37, 99, 235, 0.2);
  }
</style>

<script>
  function updateScrollProgress() {
    const max = document.documentElement.scrollHeight - window.innerHeight;
    const pct = max > 0 ? (window.scrollY / max) * 100 : 0;
    document.documentElement.style.setProperty('--sf-scroll-progress', `${pct}%`);

    const wrap = document.querySelector('.sf-header-wrap');
    if (wrap) {
      if (window.scrollY > 20) {
        wrap.classList.add('scrolled');
      } else {
        wrap.classList.remove('scrolled');
      }
    }
  }
  window.addEventListener('scroll', updateScrollProgress, { passive: true });
  updateScrollProgress();
</script>
