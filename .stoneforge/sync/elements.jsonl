{"id":"el-59tr","type":"document","createdAt":"2026-02-10T20:56:45.610Z","updatedAt":"2026-02-28T04:10:01.876Z","createdBy":"el-0000","tags":[],"metadata":{"sourceFile":"docs/reference/cli.md","migration":"docs-to-workspace"},"title":"CLI Reference","contentType":"markdown","content":"# CLI Reference\n\n**Entry point:** `packages/quarry/src/bin/sf.ts`\n**Commands:** `packages/quarry/src/cli/commands/`\n\n## Installation\n\n```bash\n# From project root\nbun link\n\n# Or use directly\nbun packages/quarry/src/bin/sf.ts\n```\n\n## Global Flags\n\n| Flag                       | Description                         |\n| -------------------------- | ----------------------------------- |\n| `--help, -h`               | Show help                           |\n| `--version, -V`            | Show version                        |\n| `--json`                   | Output as JSON                      |\n| `--quiet, -q`              | Minimal output (IDs only)           |\n| `--verbose, -v`            | Enable debug output                 |\n| `--actor <name>`           | Specify acting entity               |\n| `--from <name>`            | Alias for `--actor`                 |\n| `--db <path>`              | Override database path              |\n| `--sign-key <key>`         | Private key for signing (base64 PKCS8) |\n| `--sign-key-file <path>`   | Path to file containing private key |\n\n## Basic Commands\n\n| Command         | Description                       |\n| --------------- | --------------------------------- |\n| `sf init`       | Initialize .stoneforge directory  |\n| `sf help`       | Show help                         |\n| `sf version`    | Show version                      |\n| `sf stats`      | Show statistics                   |\n| `sf whoami`     | Show current actor                |\n| `sf serve`      | Start a Stoneforge server         |\n| `sf completion` | Generate shell completion scripts |\n| `sf alias`      | Show command aliases              |\n| `sf install`    | Install stoneforge extensions     |\n\n## CRUD Commands\n\n| Command            | Description          |\n| ------------------ | -------------------- |\n| `sf create <type>` | Create a new element |\n| `sf list [type]`   | List elements        |\n| `sf show <id>`     | Show element details |\n| `sf update <id>`   | Update element       |\n| `sf delete <id>`   | Delete element       |\n| `sf task create`   | Create task          |\n| `sf task list`     | List tasks           |\n\n```bash\n# Create task (via top-level create)\nsf create task --title \"Fix bug\" --priority 2 --type bug\n\n# Create task (via task subcommand)\nsf task create --title \"Fix bug\" --priority 2 --type bug\n\n# Create task with description (creates a linked document)\nsf task create --title \"Add login\" -d \"Implement OAuth login with Google and GitHub providers\"\n\n# List elements\nsf list task\nsf list task --status open\n\n# List tasks (via task subcommand)\nsf task list --status open\n\n# Show element\nsf show abc123\n\n# Update element\nsf update abc123 --status closed\n\n# Delete element\nsf delete abc123\n```\n\n#### create\n\nCreate a new element of the specified type. Currently supports task creation.\n\n```bash\nsf create <type> [options]\n```\n\n| Option                    | Description                                   |\n| ------------------------- | --------------------------------------------- |\n| `-t, --title <text>`      | Title for the element (required for tasks)    |\n| `-n, --name <text>`       | Alias for `--title`                           |\n| `-d, --description <text>`| Task description (creates a linked document)  |\n| `-p, --priority <1-5>`    | Priority level (1=critical, 5=minimal)        |\n| `-c, --complexity <1-5>`  | Complexity level (1=trivial, 5=very complex)  |\n| `--type <type>`           | Task type: bug, feature, task, chore          |\n| `-a, --assignee <id>`     | Assignee entity ID                            |\n| `--tag <tag>`             | Add a tag (can be repeated)                   |\n| `--plan <id\\|name>`       | Plan ID or name to attach this task to        |\n| `--no-auto-link`          | Skip auto-linking to external provider        |\n\n```bash\nsf create task --title \"Fix login bug\" --priority 1 --type bug\nsf create task -t \"Add dark mode\" --tag ui --tag feature\nsf create task -t \"New feature\" -d \"Detailed description here\"\nsf create task -t \"Implement feature X\" --plan \"My Plan Name\"\nsf create task -t \"Internal task\" --no-auto-link\n```\n\n#### list\n\nList elements with optional filtering.\n\n```bash\nsf list [type] [options]\n```\n\n| Option                  | Description                          |\n| ----------------------- | ------------------------------------ |\n| `-t, --type <type>`     | Filter by element type               |\n| `-s, --status <status>` | Filter by status (for tasks)         |\n| `-p, --priority <1-5>`  | Filter by priority (for tasks)       |\n| `-a, --assignee <id>`   | Filter by assignee (for tasks)       |\n| `--tag <tag>`           | Filter by tag (can be repeated for AND) |\n| `-l, --limit <n>`       | Maximum results (default: 50)        |\n| `-o, --offset <n>`      | Skip first n results (for pagination) |\n\n```bash\nsf list task\nsf list task --status open\nsf list --type task --priority 1 --status in_progress\nsf list --tag urgent\nsf list task --limit 20 --offset 40\n```\n\n#### show\n\nDisplay detailed information about an element.\n\n```bash\nsf show <id> [options]\n```\n\n| Option                 | Description                              |\n| ---------------------- | ---------------------------------------- |\n| `-e, --events`         | Include recent events/history            |\n| `--events-limit <n>`   | Maximum events to show (default: 10)     |\n\n```bash\nsf show el-abc123\nsf show el-abc123 --events\nsf show el-abc123 --events --events-limit 20\nsf show el-abc123 --json\nsf show inbox-abc123     # Show inbox item with message content\n```\n\n#### update\n\nUpdate fields on an existing element.\n\n```bash\nsf update <id> [options]\n```\n\n| Option                  | Description                                        |\n| ----------------------- | -------------------------------------------------- |\n| `-t, --title <text>`    | New title                                          |\n| `-p, --priority <1-5>`  | New priority (tasks only)                          |\n| `-c, --complexity <1-5>`| New complexity (tasks only)                        |\n| `-s, --status <status>` | New status (tasks only: open, in_progress, closed, deferred) |\n| `-a, --assignee <id>`   | New assignee (tasks only, empty string to unassign) |\n| `--tag <tag>`           | Replace all tags (can be repeated)                 |\n| `--add-tag <tag>`       | Add a tag (can be repeated)                        |\n| `--remove-tag <tag>`    | Remove a tag (can be repeated)                     |\n\n```bash\nsf update el-abc123 --title \"New Title\"\nsf update el-abc123 --priority 1 --status in_progress\nsf update el-abc123 --add-tag urgent --add-tag frontend\nsf update el-abc123 --remove-tag old-tag\nsf update el-abc123 --assignee \"\"  # Unassign\n```\n\n#### delete\n\nSoft-delete an element. The element is marked as deleted (tombstone) but not immediately removed.\n\n```bash\nsf delete <id> [options]\n```\n\n| Option                | Description                              |\n| --------------------- | ---------------------------------------- |\n| `-r, --reason <text>` | Deletion reason (recorded in audit trail) |\n| `-f, --force`         | Force deletion without prompting (currently a no-op; deletion is always immediate) |\n\nNote: Messages cannot be deleted as they are immutable.\n\n```bash\nsf delete el-abc123\nsf delete el-abc123 --reason \"Duplicate entry\"\nsf delete el-abc123 -f\n```\n\n## Init Command\n\nInitialize a new Stoneforge workspace in the current directory.\n\n```bash\nsf init [options]\n```\n\n| Option            | Description                      |\n| ----------------- | -------------------------------- |\n| `--name <name>`   | Workspace name (optional)        |\n| `--actor <actor>`  | Default actor for operations    |\n\nCreates a `.stoneforge/` directory containing:\n- `config.yaml` — Default configuration file\n- `stoneforge.db` — SQLite database with default operator entity (`el-0000`)\n- `.gitignore` — Git ignore patterns for database files\n- `playbooks/` — Directory for playbook definitions\n- `AGENTS.md` — Agent context file at workspace root (if no `AGENTS.md` or `CLAUDE.md` exists)\n\nIf the `.stoneforge/` directory already exists (e.g., after cloning a repo) but no database is present, `sf init` will create the database and auto-import from any existing JSONL sync files. Claude skills are also installed automatically during init.\n\n```bash\n# Initialize a new workspace\nsf init\n\n# Initialize with a specific default actor\nsf init --actor my-agent\n```\n\n## Stats Command\n\nShow statistics about the Stoneforge workspace.\n\n```bash\nsf stats [options]\n```\n\nDisplays element counts by type, ready/blocked task counts, dependency and event counts, and database size.\n\n```bash\n# Show all statistics\nsf stats\n\n# Output as JSON\nsf stats --json\n```\n\n## Serve Command\n\nStart a Stoneforge server. Supports starting either the quarry (core) or smithy (orchestrator) server.\n\n```bash\nsf serve [quarry|smithy] [options]\n```\n\n| Option         | Description                          |\n| -------------- | ------------------------------------ |\n| `-p, --port <port>` | Port to listen on                |\n| `-H, --host <host>` | Host to bind to                  |\n\n```bash\n# Start the quarry server\nsf serve quarry\n\n# Start the smithy orchestrator server\nsf serve smithy\n\n# Start on a specific port\nsf serve quarry --port 8080\n\n# Bind to a specific host\nsf serve quarry --host 0.0.0.0 --port 3000\n```\n\n## Completion Command\n\nGenerate shell completion scripts for bash, zsh, or fish.\n\n```bash\nsf completion <shell>\n```\n\n| Argument | Description                          |\n| -------- | ------------------------------------ |\n| `shell`  | Shell type: `bash`, `zsh`, or `fish` |\n\n```bash\n# Generate bash completions\nsf completion bash\n\n# Generate zsh completions\nsf completion zsh\n\n# Generate fish completions\nsf completion fish\n```\n\n**Installation:**\n\n```bash\n# Bash — add to ~/.bashrc or ~/.bash_profile:\nsource <(sf completion bash)\n# Or save to a file:\nsf completion bash > ~/.local/share/bash-completion/completions/sf\n\n# Zsh — add to ~/.zshrc:\nsource <(sf completion zsh)\n# Or save to a file in your fpath:\nsf completion zsh > ~/.zsh/completions/_sf\n\n# Fish — save to completions directory:\nsf completion fish > ~/.config/fish/completions/sf.fish\n```\n\n## Alias Command\n\nDisplay all available command aliases. Aliases provide shorter or more intuitive names for existing commands.\n\n```bash\nsf alias\n```\n\n**Built-in aliases:**\n\n| Alias              | Maps to      |\n| ------------------ | ------------ |\n| `add`, `new`       | `create`     |\n| `rm`, `remove`     | `delete`     |\n| `ls`               | `list`       |\n| `s`, `get`         | `show`       |\n| `todo`, `tasks`    | `ready`      |\n| `done`, `complete` | `close`      |\n| `st`               | `status`     |\n| `dep`              | `dependency` |\n| `msg`              | `message`    |\n| `doc`              | `document`   |\n\n**Plugin aliases** (available when the orchestrator plugin is loaded):\n\n| Alias              | Maps to      |\n| ------------------ | ------------ |\n| `agents`           | `agent list` |\n| `pools`            | `pool list`  |\n\n```bash\n# Show all aliases\nsf alias\n\n# Output as JSON\nsf alias --json\n```\n\nPlugins can register additional aliases. See [CLI Plugins](#cli-plugins) for details.\n\n## Install Command\n\nInstall stoneforge extensions to the workspace.\n\n```bash\nsf install <subcommand> [options]\n```\n\n| Subcommand | Description                          |\n| ---------- | ------------------------------------ |\n| `skills`   | Install Claude skills to `.claude/skills/` |\n\n#### install skills\n\nInstall Claude skills files to the workspace's `.claude/skills/` directory.\n\n| Option          | Description                  |\n| --------------- | ---------------------------- |\n| `-f, --force`   | Overwrite existing skill files |\n\n```bash\n# Install Claude skills\nsf install skills\n\n# Overwrite existing skills\nsf install skills --force\n```\n\n## Task Commands\n\n| Command                          | Description                        |\n| -------------------------------- | ---------------------------------- |\n| `sf task ready`                  | List ready (unblocked, open) tasks |\n| `sf task blocked`                | List blocked tasks                 |\n| `sf task backlog`                | List backlog tasks                 |\n| `sf task activate <id>`          | Move a task from backlog to open   |\n| `sf task close <id>`             | Close task                         |\n| `sf task reopen <id>`            | Reopen task                        |\n| `sf task show <id>`              | Show task details                  |\n| `sf task update <id>`            | Update task fields                 |\n| `sf task delete <id>`            | Delete task                        |\n| `sf task assign <task> <entity>` | Assign task                        |\n| `sf task defer <id>`             | Defer task                         |\n| `sf task undefer <id>`           | Remove deferral                    |\n| `sf task describe <id>`          | Set or show task description       |\n\n**Top-level convenience commands:** Common task operations are also available as top-level commands (without the `task` prefix):\n\n| Top-level Command           | Equivalent                   |\n| --------------------------- | ---------------------------- |\n| `sf ready`                  | `sf task ready`              |\n| `sf blocked`                | `sf task blocked`            |\n| `sf backlog`                | `sf task backlog`            |\n| `sf close <id>`             | `sf task close <id>`         |\n| `sf reopen <id>`            | `sf task reopen <id>`        |\n| `sf assign <task> <entity>` | `sf task assign <task> <entity>` |\n| `sf defer <id>`             | `sf task defer <id>`         |\n| `sf undefer <id>`           | `sf task undefer <id>`       |\n\n```bash\n# List ready tasks\nsf task ready\n\n# Close with reason\nsf task close abc123 --reason \"Fixed in commit xyz\"\n\n# Assign task\nsf task assign abc123 worker-1\n\n# Set task description\nsf task describe el-abc123 --content \"Implement login feature\"\nsf task describe el-abc123 --file description.md\n\n# Show task description\nsf task describe el-abc123 --show\n```\n\n#### task ready\n\nList ready (unblocked, open) tasks.\n\n| Option                 | Description                       |\n| ---------------------- | --------------------------------- |\n| `-a, --assignee <id>`  | Filter by assignee                |\n| `-p, --priority <1-5>` | Filter by priority                |\n| `-t, --type <type>`    | Filter by task type (bug, feature, task, chore) |\n| `-l, --limit <n>`      | Maximum results                   |\n\n```bash\nsf task ready\nsf task ready --assignee alice\nsf task ready --priority 1\nsf task ready --type bug --limit 10\n```\n\n#### task backlog\n\nList backlog tasks.\n\n| Option                 | Description                       |\n| ---------------------- | --------------------------------- |\n| `-p, --priority <1-5>` | Filter by priority                |\n| `-l, --limit <n>`      | Maximum results                   |\n\n```bash\nsf task backlog\nsf task backlog --priority 1 --limit 20\n```\n\n#### task blocked\n\nList blocked tasks.\n\n| Option                 | Description                       |\n| ---------------------- | --------------------------------- |\n| `-a, --assignee <id>`  | Filter by assignee                |\n| `-p, --priority <1-5>` | Filter by priority                |\n| `-l, --limit <n>`      | Maximum results                   |\n\n```bash\nsf task blocked\nsf task blocked --assignee alice --priority 1\n```\n\n#### task close\n\nClose a task.\n\n| Option                | Description              |\n| --------------------- | ------------------------ |\n| `-r, --reason <text>` | Reason for closing       |\n\n```bash\nsf task close abc123\nsf task close abc123 --reason \"Fixed in commit xyz\"\n```\n\n#### task reopen\n\nReopen a closed task.\n\n| Option                 | Description                                  |\n| ---------------------- | -------------------------------------------- |\n| `-m, --message <text>` | Message to append to task description        |\n\n```bash\nsf task reopen abc123\nsf task reopen abc123 --message \"Reopening — issue not fully resolved\"\n```\n\n#### task assign\n\nAssign a task to an entity.\n\n| Option           | Description                       |\n| ---------------- | --------------------------------- |\n| `-u, --unassign` | Remove assignment instead         |\n\n```bash\nsf task assign abc123 worker-1\nsf task assign abc123 worker-1 --unassign\n```\n\n#### task defer\n\nDefer a task until a future date.\n\n| Option             | Description                        |\n| ------------------ | ---------------------------------- |\n| `--until <date>`   | Date to defer until (ISO format)   |\n\n```bash\nsf task defer abc123 --until 2025-06-01\nsf task undefer abc123\n```\n\n#### task describe\n\nSet or show a task's description. Descriptions are stored as versioned documents.\n\n| Option                 | Description                                         |\n| ---------------------- | --------------------------------------------------- |\n| `-c, --content <text>` | Description content (inline)                        |\n| `-f, --file <path>`    | Read description from file                          |\n| `-s, --show`           | Show current description instead of setting         |\n| `--append`             | Append to existing description instead of replacing |\n\n```bash\n# Set description inline\nsf task describe el-abc123 --content \"Implement the login feature with OAuth support\"\n\n# Set description from file\nsf task describe el-abc123 --file specs/login.md\n\n# Show current description\nsf task describe el-abc123 --show\n\n# Append to existing description\nsf task describe el-abc123 --append --content \"Additional implementation notes\"\nsf task describe el-abc123 --append -f additional-notes.md\n```\n\n#### task list\n\nList tasks with optional filtering.\n\n| Option                  | Description                                                                                                                  |\n| ----------------------- | ---------------------------------------------------------------------------------------------------------------------------- |\n| `-s, --status <status>` | Filter by status                                                                                                             |\n| `--ready`               | Show only dispatch-ready tasks (accounts for blocked cache, draft plans, scheduled-for-future, ephemeral workflows, and plan-level blocking). Mutually exclusive with `--status`. |\n| `-t, --type <type>`     | Filter by task type (bug, feature, task, chore). Only effective with `--ready`; in standard list mode, the type is implicitly `task`. |\n| `-p, --priority <1-5>`  | Filter by priority                                                                                                           |\n| `-a, --assignee <id>`   | Filter by assignee                                                                                                           |\n| `--tag <tag>`           | Filter by tag (can be repeated for AND logic)                                                                                |\n| `-l, --limit <n>`       | Maximum results (default: 50)                                                                                                |\n| `-o, --offset <n>`      | Skip first n results (for pagination)                                                                                        |\n\n```bash\n# List all tasks\nsf task list\n\n# Filter by status\nsf task list --status open\n\n# Show dispatch-ready tasks (more precise than --status open)\nsf task list --ready\n\n# Ready tasks assigned to a specific agent\nsf task list --ready --assignee alice\n\n# Filter by priority and status\nsf task list --priority 1 --status in_progress\n\n# Filter by type\nsf task list --type bug\n\n# Filter by tag\nsf task list --tag frontend --tag urgent\n\n# Paginate results\nsf task list --status open --limit 20 --offset 40\n```\n\n## Dependency Commands\n\n| Command                   | Description          |\n| ------------------------- | -------------------- |\n| `sf dependency add`       | Add dependency       |\n| `sf dependency remove`    | Remove dependency    |\n| `sf dependency list <id>` | List dependencies    |\n| `sf dependency tree <id>` | Show dependency tree |\n\n```bash\n# Add blocking dependency\n# A is blocked BY B (B must complete first)\nsf dependency add --type=blocks A B\n\n# Remove dependency\nsf dependency remove A B --type=blocks\n\n# List dependencies\nsf dependency list abc123 -d out     # Outgoing\nsf dependency list abc123 -d in      # Incoming\nsf dependency list abc123 -d both    # Both\n\n# Show tree\nsf dependency tree abc123\n```\n\n#### dependency add\n\nAdd a dependency between two elements.\n\n| Option                 | Description                                           |\n| ---------------------- | ----------------------------------------------------- |\n| `-t, --type <type>`    | Dependency type (required): blocks, parent-child, awaits, relates-to, references, supersedes, duplicates, caused-by, validates, mentions, authored-by, assigned-to, approved-by, replies-to |\n| `-m, --metadata <json>` | JSON metadata to attach to the dependency            |\n\n```bash\nsf dependency add --type=blocks A B\nsf dependency add --type=relates-to A B --metadata '{\"reason\": \"data dependency\"}'\n```\n\n**Semantics:** `sf dependency add --type=blocks A B` means A (blocked) is blocked BY B (blocker).\n\n#### dependency list\n\nList dependencies for an element.\n\n| Option                    | Description                                      |\n| ------------------------- | ------------------------------------------------ |\n| `-t, --type <type>`       | Filter by dependency type                        |\n| `-d, --direction <dir>`   | Direction: out, in, or both (default: both)      |\n\n```bash\nsf dependency list abc123\nsf dependency list abc123 -d out\nsf dependency list abc123 -d in --type blocks\n```\n\n#### dependency tree\n\nShow dependency tree for an element.\n\n| Option              | Description                       |\n| ------------------- | --------------------------------- |\n| `-d, --depth <n>`   | Maximum tree depth (default: 5)   |\n\n```bash\nsf dependency tree abc123\nsf dependency tree abc123 --depth 3\n```\n\n## Entity Commands\n\n| Command                                    | Description          |\n| ------------------------------------------ | -------------------- |\n| `sf entity register <name>`                | Register new entity  |\n| `sf entity list`                           | List entities        |\n| `sf entity set-manager <entity> <manager>` | Set manager          |\n| `sf entity clear-manager <entity>`         | Clear manager        |\n| `sf entity reports <manager>`              | Get direct reports   |\n| `sf entity chain <entity>`                 | Get management chain |\n\n#### entity register\n\nRegister a new entity.\n\n| Option                    | Description                                         |\n| ------------------------- | --------------------------------------------------- |\n| `-t, --type <type>`       | Entity type: agent, human, or system (default: agent) |\n| `--public-key <key>`      | Base64-encoded Ed25519 public key                   |\n| `--tag <tag>`             | Add tag (can be repeated)                           |\n\n```bash\nsf entity register alice\nsf entity register alice --type human\nsf entity register bot-1 --type agent --tag worker --tag deploy\nsf entity register svc --type system --public-key \"base64key...\"\n```\n\n#### entity list\n\nList registered entities.\n\n| Option                | Description                       |\n| --------------------- | --------------------------------- |\n| `-t, --type <type>`   | Filter by entity type             |\n| `-l, --limit <n>`     | Maximum results                   |\n\n```bash\nsf entity list\nsf entity list --type agent\nsf entity list --type human --limit 10\n```\n\n## Document Commands\n\n| Command                               | Description                                   |\n| ------------------------------------- | --------------------------------------------- |\n| `sf document create`                  | Create document                               |\n| `sf document list`                    | List documents                                |\n| `sf document search <query>`          | Full-text search documents                    |\n| `sf document show <id>`               | Show document                                 |\n| `sf document update <id>`             | Update document content (creates new version) |\n| `sf document history <id>`            | Show version history                          |\n| `sf document rollback <id> <version>` | Rollback to version                           |\n| `sf document archive <id>`            | Archive document                              |\n| `sf document unarchive <id>`          | Unarchive document                            |\n| `sf document delete <id>`             | Delete document (soft-delete via tombstone)    |\n| `sf document reindex`                 | Reindex documents for FTS5 search             |\n\n#### document create\n\nCreate a new document.\n\n| Option                  | Description                                    |\n| ----------------------- | ---------------------------------------------- |\n| `--title <text>`        | Document title                                 |\n| `-c, --content <text>`  | Document content (inline)                      |\n| `-f, --file <path>`     | Read content from file                         |\n| `-t, --type <type>`     | Document type: text, markdown, or json         |\n| `--category <cat>`      | Document category                              |\n| `--tag <tag>`           | Add tag (can be repeated)                      |\n| `-m, --metadata <json>` | JSON metadata                                  |\n\n#### document list\n\nList documents.\n\n| Option                   | Description                                           |\n| ------------------------ | ----------------------------------------------------- |\n| `-l, --limit <n>`        | Maximum results                                       |\n| `-t, --type <type>`      | Filter by document type                               |\n| `--category <cat>`       | Filter by category                                    |\n| `--status <status>`      | Filter by status: active or archived                  |\n| `-a, --all`              | Include archived documents                            |\n\n#### document show\n\nShow document content.\n\n| Option                    | Description                       |\n| ------------------------- | --------------------------------- |\n| `-V, --doc-version <ver>` | Show specific version             |\n\n#### document search\n\nFull-text search documents.\n\n| Option                   | Description                       |\n| ------------------------ | --------------------------------- |\n| `--category <cat>`       | Filter by category                |\n| `--status <status>`      | Filter by status                  |\n| `-l, --limit <n>`        | Maximum results                   |\n\n#### document history\n\nShow version history for a document.\n\n| Option              | Description                       |\n| ------------------- | --------------------------------- |\n| `-l, --limit <n>`   | Maximum results                   |\n\n```bash\n# Create document with category\nsf document create --title \"API Spec\" --category spec\n\n# List documents (active only by default)\nsf document list\nsf document list --category spec\nsf document list --status archived\nsf document list --all                    # Include archived\n\n# Full-text search documents\nsf document search \"API authentication\"\nsf document search \"migration\" --category spec\nsf document search \"config\" --limit 5\n\n# Update document content (creates new version)\nsf document update el-doc123 --content \"Updated content\"\nsf document update el-doc123 --file updated-spec.md\n\n# Archive / unarchive\nsf document archive abc123\nsf document unarchive abc123\n\n# Delete document (soft-delete)\nsf document delete el-doc123\nsf document delete el-doc123 --reason \"outdated\"\n\n# Reindex FTS5\nsf document reindex\n```\n\n#### document update\n\nUpdate a document's content, creating a new version. Documents are versioned - each update preserves history.\n\n| Option                    | Description                       |\n| ------------------------- | --------------------------------- |\n| `-c, --content <text>`    | New content (inline)              |\n| `-f, --file <path>`       | Read new content from file        |\n| `-m, --metadata <json>`   | JSON metadata to merge            |\n\n```bash\nsf document update el-doc123 --content \"New content here\"\nsf document update el-doc123 --file path/to/updated.md\nsf document update el-doc123 --metadata '{\"reviewer\": \"alice\"}'\n```\n\n#### document delete\n\nDelete a document via soft-delete (tombstone). The document's content is preserved but marked as deleted.\n\n| Option                  | Description              |\n| ----------------------- | ------------------------ |\n| `-r, --reason <text>`   | Reason for deletion      |\n| `-f, --force`           | Skip confirmation        |\n\n```bash\nsf document delete el-doc123\nsf document delete el-doc123 --reason \"outdated\"\nsf document delete el-doc123 --force\n```\n\n## Embeddings Commands\n\n| Command                        | Description                    |\n| ------------------------------ | ------------------------------ |\n| `sf embeddings install`        | Install local embedding model  |\n| `sf embeddings status`         | Show embedding model status    |\n| `sf embeddings reindex`        | Rebuild document embeddings    |\n| `sf embeddings search <query>` | Semantic search over documents |\n\n```bash\n# Install the local embedding model\nsf embeddings install\n\n# Check status\nsf embeddings status\n\n# Rebuild embeddings index\nsf embeddings reindex\n\n# Search documents by semantic similarity\nsf embeddings search \"authentication flow\"\n```\n\n## Plan Commands\n\n| Command                           | Description                       |\n| --------------------------------- | --------------------------------- |\n| `sf plan create`                  | Create plan (defaults to draft)   |\n| `sf plan list`                    | List plans                        |\n| `sf plan show <id>`               | Show plan details                 |\n| `sf plan activate <id>`           | Activate plan (enables dispatch)  |\n| `sf plan complete <id>`           | Mark completed                    |\n| `sf plan cancel <id>`             | Cancel plan                       |\n| `sf plan add-task <id> <task>`    | Add task to plan                  |\n| `sf plan remove-task <id> <task>` | Remove task                       |\n| `sf plan tasks <id>`              | List tasks in plan                |\n| `sf plan auto-complete`           | Auto-complete active plans        |\n\n#### plan create\n\nCreate a new plan.\n\n| Option                  | Description                                         |\n| ----------------------- | --------------------------------------------------- |\n| `-t, --title <text>`    | Plan title (required)                               |\n| `-s, --status <status>` | Initial status: draft (default) or active           |\n| `--tag <tag>`           | Add tag (can be repeated)                           |\n\n```bash\nsf plan create --title \"Feature X\"\nsf plan create --title \"Hotfix\" --status active\nsf plan create --title \"Q3 Roadmap\" --tag roadmap --tag q3\n```\n\n#### plan list\n\nList plans.\n\n| Option                  | Description                                         |\n| ----------------------- | --------------------------------------------------- |\n| `-s, --status <status>` | Filter by status: draft, active, completed, cancelled |\n| `--tag <tag>`           | Filter by tag (can be repeated for AND logic)       |\n| `-l, --limit <n>`       | Maximum results                                     |\n\n```bash\nsf plan list\nsf plan list --status active\nsf plan list --tag roadmap --limit 10\n```\n\n#### plan show\n\nShow plan details, optionally including its task list.\n\n| Option           | Description              |\n| ---------------- | ------------------------ |\n| `-t, --tasks`    | Include task list        |\n\n```bash\nsf plan show el-abc123\nsf plan show el-abc123 --tasks\nsf plan show el-abc123 --json\n```\n\n#### plan auto-complete\n\nAuto-complete active plans where all tasks are closed. Scans all active plans and transitions those with all tasks in a closed state to completed status.\n\nThis command is idempotent and safe to run at any time. It serves as both a backfill tool for stuck plans and an ongoing maintenance command.\n\n| Option      | Description                                           |\n| ----------- | ----------------------------------------------------- |\n| `--dry-run` | Show what would be auto-completed without making changes |\n\n```bash\n# Auto-complete eligible plans\nsf plan auto-complete\n\n# Preview what would be completed\nsf plan auto-complete --dry-run\n\n# With JSON output\nsf plan auto-complete --json\n```\n\n#### plan cancel\n\nCancel a plan.\n\n| Option                | Description              |\n| --------------------- | ------------------------ |\n| `-r, --reason <text>` | Reason for cancellation  |\n\n```bash\nsf plan cancel el-plan123\nsf plan cancel el-plan123 --reason \"Superseded by new plan\"\n```\n\n#### plan tasks\n\nList tasks belonging to a plan.\n\n| Option                  | Description                       |\n| ----------------------- | --------------------------------- |\n| `-s, --status <status>` | Filter by task status             |\n| `-l, --limit <n>`       | Maximum results                   |\n\n```bash\nsf plan tasks el-plan123\nsf plan tasks el-plan123 --status open\nsf plan tasks el-plan123 --status closed --limit 10\n```\n\n### Draft Plan Workflow\n\nPlans default to `draft` status. **Tasks in draft plans are NOT dispatchable** — the dispatch daemon will not assign them to workers. This prevents premature dispatch before dependencies are set.\n\n```bash\n# 1. Create plan (defaults to draft)\nsf plan create --title \"Feature X\"\n\n# 2. Create tasks in the plan (not yet dispatchable)\nsf task create --title \"Task 1\" --plan \"Feature X\"\nsf task create --title \"Task 2\" --plan \"Feature X\"\n\n# 3. Set dependencies between tasks\nsf dependency add el-task2 el-task1 --type blocks\n\n# 4. Activate plan (tasks become dispatchable)\nsf plan activate <plan-id>\n```\n\n**Important:** Always use plans when creating tasks with dependencies to avoid race conditions with the dispatch daemon.\n\n## Workflow Commands\n\n| Command                         | Description               |\n| ------------------------------- | ------------------------- |\n| `sf workflow create <playbook>` | Instantiate from playbook |\n| `sf workflow list`              | List workflows            |\n| `sf workflow show <id>`         | Show details              |\n| `sf workflow tasks <id>`        | List tasks                |\n| `sf workflow progress <id>`     | Show progress             |\n| `sf workflow delete <id>`       | Delete ephemeral          |\n| `sf workflow promote <id>`      | Promote to durable        |\n| `sf workflow gc`                | Garbage collect           |\n\n#### workflow list\n\nList workflows.\n\n| Option                  | Description                              |\n| ----------------------- | ---------------------------------------- |\n| `-s, --status <status>` | Filter by status                         |\n| `-e, --ephemeral`       | Show only ephemeral workflows            |\n| `-d, --durable`         | Show only durable workflows              |\n| `-l, --limit <n>`       | Maximum results                          |\n\n```bash\nsf workflow list\nsf workflow list --status running\nsf workflow list --ephemeral\nsf workflow list --durable --limit 10\n```\n\n#### workflow tasks\n\nList tasks in a workflow.\n\n| Option                  | Description                       |\n| ----------------------- | --------------------------------- |\n| `-r, --ready`           | Show only ready tasks             |\n| `-s, --status <status>` | Filter by task status             |\n| `-l, --limit <n>`       | Maximum results                   |\n\n```bash\nsf workflow tasks el-wf123\nsf workflow tasks el-wf123 --ready\nsf workflow tasks el-wf123 --status open --limit 20\n```\n\n#### workflow delete\n\nDelete a workflow.\n\n| Option          | Description                                   |\n| --------------- | --------------------------------------------- |\n| `-f, --force`   | Required for deleting durable workflows       |\n\n```bash\nsf workflow delete el-wf123\nsf workflow delete el-wf123 --force\n```\n\n#### workflow create\n\nInstantiate a playbook into a workflow.\n\n| Option                  | Description                               |\n| ----------------------- | ----------------------------------------- |\n| `--var <name=value>`    | Set variable (can be repeated)            |\n| `-e, --ephemeral`       | Create as ephemeral (not synced to JSONL) |\n| `-t, --title <text>`    | Override workflow title                   |\n\n```bash\n# Instantiate workflow\nsf workflow create my-playbook --var name=value\n\n# Create as ephemeral (not persisted to sync)\nsf workflow create deploy --ephemeral\n\n# Override the workflow title\nsf workflow create deploy --title \"Production Deploy v1.2\"\n\n# Combine options\nsf workflow create deploy --var env=prod --var version=1.2 --ephemeral\n```\n\n#### workflow gc\n\nGarbage collect old ephemeral workflows. Deletes workflows that are in a terminal state (completed, failed, or cancelled) and older than the specified age.\n\n| Option              | Description                                      |\n| ------------------- | ------------------------------------------------ |\n| `-a, --age <days>`  | Maximum age in days (default: 7)                 |\n| `--dry-run`         | Show what would be deleted without deleting      |\n\n```bash\n# Garbage collect (default 7 days)\nsf workflow gc --age 14\n\n# Preview deletions\nsf workflow gc --dry-run\n```\n\n**Note:** See also [`sf gc workflows`](#gc-commands) which provides the same functionality with different defaults (1 day) and an additional `--limit` flag. See the [GC Commands](#gc-commands) section for details on when to use each.\n\n## Inbox Commands\n\n| Command                 | Description                          |\n| ----------------------- | ------------------------------------ |\n| `sf inbox <agent-id>`   | List inbox items with message preview |\n| `sf inbox read <id>`    | Mark as read                         |\n| `sf inbox read-all <entity>` | Mark all as read for entity     |\n| `sf inbox unread <id>`  | Mark as unread                       |\n| `sf inbox archive <id>` | Archive item                         |\n| `sf inbox count <entity>` | Count unread for entity            |\n| `sf show <inbox-id>`    | Show inbox item with full content    |\n\n#### inbox list\n\nList inbox items with message content preview.\n\n| Option                   | Description                                          |\n| ------------------------ | ---------------------------------------------------- |\n| `-a, --all`              | Include read and archived items (default: unread only) |\n| `-s, --status <status>`  | Filter by status: unread, read, or archived          |\n| `-l, --limit <n>`        | Maximum number of items to return                    |\n| `-F, --full`             | Show complete message content instead of truncated   |\n\n```bash\n# List unread inbox items with message preview\nsf inbox alice\n\n# Show full message content\nsf inbox alice --full\n\n# Include all items (read, archived)\nsf inbox alice --all\n\n# Show single inbox item with full content\nsf show inbox-abc123\n```\n\n## Channel Commands\n\n| Command                           | Description                                             |\n| --------------------------------- | ------------------------------------------------------- |\n| `sf channel create`               | Create channel (`--description, -D` to set description) |\n| `sf channel list`                 | List channels                                           |\n| `sf channel join <id>`            | Join channel                                            |\n| `sf channel leave <id>`           | Leave channel                                           |\n| `sf channel members <id>`         | List members                                            |\n| `sf channel add <ch> <entity>`    | Add member                                              |\n| `sf channel remove <ch> <entity>` | Remove member                                           |\n| `sf channel merge`                | Merge two channels                                      |\n\n#### channel create\n\n| Option                     | Description                                      |\n| -------------------------- | ------------------------------------------------ |\n| `-n, --name <name>`        | Channel name (required for group channels)       |\n| `-D, --description <text>` | Channel description                              |\n| `-t, --type <type>`        | Channel type: group (default) or direct          |\n| `-V, --visibility <vis>`   | Visibility: public or private (default)          |\n| `-p, --policy <policy>`    | Join policy: open, invite-only (default), or request |\n| `-m, --member <id>`        | Add member (can be repeated)                     |\n| `-d, --direct <entity>`    | Create direct channel with entity (for --type direct) |\n| `--tag <tag>`              | Add tag (can be repeated)                        |\n\n```bash\nsf channel create --name general --description \"General discussion\"\nsf channel create --name private-ops -V private -p invite-only\nsf channel create --type direct --direct el-user123\nsf channel create --name team --member el-a --member el-b\n```\n\n#### channel list\n\nList channels.\n\n| Option                | Description                              |\n| --------------------- | ---------------------------------------- |\n| `-t, --type <type>`   | Filter by type: group or direct          |\n| `-m, --member <id>`   | Filter by member                         |\n| `-l, --limit <n>`     | Maximum results                          |\n\n```bash\nsf channel list\nsf channel list --type group\nsf channel list --member alice --limit 10\n```\n\n#### channel merge\n\nMerge all messages from a source channel into a target channel. Both channels must be group channels. The source channel is archived after the merge.\n\n```bash\nsf channel merge --source <id> --target <id> [--name <new-name>]\n```\n\n| Option                  | Description                              |\n| ----------------------- | ---------------------------------------- |\n| `-s, --source <id>`     | Source channel ID (required)             |\n| `-t, --target <id>`     | Target channel ID (required)             |\n| `-n, --name <new-name>` | Optional new name for the merged channel |\n\n```bash\n# Merge source into target\nsf channel merge --source el-ch111 --target el-ch222\n\n# Merge and rename the target channel\nsf channel merge -s el-ch111 -t el-ch222 --name \"combined-channel\"\n```\n\n## Message Commands\n\n| Command                  | Description                                        |\n| ------------------------ | -------------------------------------------------- |\n| `sf message send`        | Send message to channel, entity, or as reply       |\n| `sf message reply <id>`  | Reply to a message (shorthand for send --reply-to) |\n| `sf message thread <id>` | View thread messages                               |\n| `sf message list`        | List messages                                      |\n\n#### message send\n\n| Option                  | Description                                                                      |\n| ----------------------- | -------------------------------------------------------------------------------- |\n| `-c, --channel <id>`    | Channel to send to                                                               |\n| `-T, --to <entity>`     | Entity to send DM to (finds or creates DM channel)                               |\n| `-r, --reply-to <msg>`  | Message ID to reply to (auto-sets channel, thread, swaps sender/recipient in DM) |\n| `-m, --content <text>`  | Message content                                                                  |\n| `--file <path>`         | Read content from file                                                           |\n| `-t, --thread <id>`     | Reply to message (creates thread)                                                |\n| `-a, --attachment <id>` | Attach document (can be repeated)                                                |\n| `--tag <tag>`           | Add tag (can be repeated)                                                        |\n\n```bash\n# Send to channel\nsf message send --channel el-abc123 --content \"Hello!\"\n\n# Send DM to entity (finds or creates DM channel)\nsf message send --to el-user456 -m \"Direct message\"\n\n# Send DM with explicit sender\nsf --from agent-1 message send --to agent-2 -m \"Message from agent-1\"\n\n# Reply to a message (auto-swaps sender/recipient in DM)\nsf message send --reply-to el-msg789 -m \"Reply to your message\"\n```\n\n#### message reply\n\nShorthand for `sf message send --reply-to`. Automatically sets channel and thread from the replied-to message. In DM channels, sender/recipient are swapped unless `--from` is specified.\n\n| Option                  | Description                       |\n| ----------------------- | --------------------------------- |\n| `-m, --content <text>`  | Message content                   |\n| `--file <path>`         | Read content from file            |\n| `-a, --attachment <id>` | Attach document (can be repeated) |\n| `--tag <tag>`           | Add tag (can be repeated)         |\n\n```bash\nsf message reply el-msg123 --content \"Thanks for the update!\"\nsf --from bot message reply el-msg123 -m \"Automated response\"\n```\n\n#### message list\n\nList messages in a channel.\n\n| Option                 | Description                              |\n| ---------------------- | ---------------------------------------- |\n| `-c, --channel <id>`   | Channel ID (required)                    |\n| `-s, --sender <id>`    | Filter by sender                         |\n| `-r, --root-only`      | Show only root messages (no replies)     |\n| `-l, --limit <n>`      | Maximum results                          |\n\n```bash\nsf message list --channel el-ch123\nsf message list --channel el-ch123 --sender alice --limit 20\n```\n\n#### message thread\n\nView thread messages for a message.\n\n| Option              | Description                       |\n| ------------------- | --------------------------------- |\n| `-l, --limit <n>`   | Maximum results                   |\n\n```bash\nsf message thread el-msg123\nsf message thread el-msg123 --limit 50\n```\n\n## Team Commands\n\n| Command                          | Description   |\n| -------------------------------- | ------------- |\n| `sf team create`                 | Create team   |\n| `sf team list`                   | List teams    |\n| `sf team add <team> <entity>`    | Add member    |\n| `sf team remove <team> <entity>` | Remove member |\n| `sf team members <id>`           | List members  |\n| `sf team delete <id>`            | Delete team   |\n\n#### team create\n\nCreate a new team.\n\n| Option                | Description                       |\n| --------------------- | --------------------------------- |\n| `-n, --name <name>`   | Team name (required)              |\n| `-m, --member <id>`   | Add member (can be repeated)      |\n| `--tag <tag>`         | Add tag (can be repeated)         |\n\n```bash\nsf team create --name \"Backend Team\"\nsf team create --name \"Frontend\" --member alice --member bob --tag frontend\n```\n\n#### team list\n\nList teams.\n\n| Option                | Description                       |\n| --------------------- | --------------------------------- |\n| `-m, --member <id>`   | Filter by member                  |\n| `-l, --limit <n>`     | Maximum results                   |\n\n```bash\nsf team list\nsf team list --member alice\nsf team list --limit 10\n```\n\n#### team delete\n\nDelete a team.\n\n| Option                | Description              |\n| --------------------- | ------------------------ |\n| `-r, --reason <text>` | Reason for deletion      |\n| `-f, --force`         | Skip confirmation for teams with members |\n\n```bash\nsf team delete el-team123\nsf team delete el-team123 --reason \"Team dissolved\" --force\n```\n\n## Library Commands\n\n| Command                              | Description                      |\n| ------------------------------------ | -------------------------------- |\n| `sf library create`                  | Create a new library             |\n| `sf library list`                    | List libraries                   |\n| `sf library roots`                   | List root libraries              |\n| `sf library docs <id>`              | List documents in a library      |\n| `sf library stats <id>`             | Show library statistics          |\n| `sf library add <lib> <doc>`        | Add document to library          |\n| `sf library remove <lib> <doc>`     | Remove document from library     |\n| `sf library nest <child> <parent>`  | Nest a library under another     |\n| `sf library delete <id>`            | Delete a library                 |\n\n#### library create\n\nCreate a new library.\n\n| Option                | Description                       |\n| --------------------- | --------------------------------- |\n| `-n, --name <name>`   | Library name (required)           |\n| `--tag <tag>`         | Add tag (can be repeated)         |\n\n#### library list\n\nList libraries.\n\n| Option              | Description                       |\n| ------------------- | --------------------------------- |\n| `-l, --limit <n>`   | Maximum results                   |\n\n#### library delete\n\nDelete a library.\n\n| Option          | Description                       |\n| --------------- | --------------------------------- |\n| `-f, --force`   | Force deletion even if library has contents |\n\n```bash\n# Create a library\nsf library create --name \"API Documentation\"\nsf library create -n \"Design Docs\" --tag design --tag frontend\n\n# List all libraries\nsf library list\n\n# List root libraries (not nested)\nsf library roots\n\n# Manage documents in a library\nsf library add el-lib123 el-doc456\nsf library remove el-lib123 el-doc456\nsf library docs el-lib123\n\n# Create hierarchy\nsf library nest el-sub123 el-parent456\n\n# Delete\nsf library delete el-lib123\nsf library delete el-lib123 --force\n```\n\n## Docs Commands\n\nConvenience shortcuts for documentation infrastructure.\n\n| Command                           | Description                                           |\n| --------------------------------- | ----------------------------------------------------- |\n| `sf docs init`                    | Bootstrap Documentation library and directory         |\n| `sf docs add <doc-id> [doc-id2]`  | Add document(s) to the Documentation library          |\n| `sf docs dir`                     | Show the Documentation Directory document             |\n\n#### docs init\n\nIdempotently finds or creates the Documentation library and a Documentation Directory document (reference category). Running multiple times produces the same result without duplicates.\n\n```bash\nsf docs init\nsf docs init --json\nsf docs init --quiet\n```\n\n#### docs add\n\nAdd one or more documents to the Documentation library. The library must exist (run `sf docs init` first).\n\n| Argument | Description |\n|----------|-------------|\n| `<doc-id>` | One or more document identifiers to add |\n\n```bash\nsf docs add el-doc123\nsf docs add el-doc123 el-doc456 el-doc789\nsf docs add el-doc123 --json\n```\n\n#### docs dir\n\nFind and display the Documentation Directory document. Shows the ID and title of the directory. Use `--content` to also display the full markdown content. The Documentation Directory must exist (run `sf docs init` first).\n\n| Option | Description |\n|--------|-------------|\n| `--content` | Include the full document content in output |\n\n```bash\nsf docs dir\nsf docs dir --content\nsf docs dir --json\nsf docs dir --quiet\n```\n\n---\n\n## Playbook Commands\n\n| Command                             | Description                                    |\n| ----------------------------------- | ---------------------------------------------- |\n| `sf playbook list`                  | List playbooks                                 |\n| `sf playbook show <name\\|id>`       | Show playbook details                          |\n| `sf playbook validate <name\\|id>`   | Validate playbook structure and variables      |\n| `sf playbook create`                | Create a new playbook                          |\n\n```bash\n# List all playbooks\nsf playbook list\nsf playbook list --limit 10\n\n# Show playbook details\nsf playbook show deploy\nsf playbook show el-abc123 --steps --variables\n\n# Validate playbook structure\nsf playbook validate deploy\nsf playbook validate deploy --create\nsf playbook validate deploy --var env=production --var debug=true\n\n# Create a new playbook\nsf playbook create --name deploy --title \"Deployment Process\"\nsf playbook create -n deploy -t \"Deploy\" -s \"build:Build app\" -s \"test:Run tests:build\"\nsf playbook create -n deploy -t \"Deploy\" -v \"env:string\" -v \"debug:boolean:false:false\"\n```\n\n#### playbook show\n\n| Option               | Description              |\n| -------------------- | ------------------------ |\n| `-s, --steps`        | Include step definitions |\n| `-v, --variables`    | Include variable definitions |\n\n#### playbook validate\n\n| Option                   | Description                                              |\n| ------------------------ | -------------------------------------------------------- |\n| `--var <name=value>`     | Set variable for create-time validation (can be repeated) |\n| `-c, --create`           | Perform create-time validation                           |\n\n#### playbook create\n\n| Option                    | Description                                                |\n| ------------------------- | ---------------------------------------------------------- |\n| `-n, --name <name>`       | Playbook name (unique identifier, required)               |\n| `-t, --title <title>`     | Playbook title (display name, required)                   |\n| `-s, --step <spec>`       | Add step (format: `id:title[:dependsOn,...]`, repeatable) |\n| `-v, --variable <spec>`   | Add variable (format: `name:type[:default][:required]`, repeatable) |\n| `-e, --extends <name>`    | Extend playbook (can be repeated)                         |\n| `--tag <tag>`             | Add tag (can be repeated)                                 |\n\n## Sync Commands\n\nSync commands manage the JSONL-based import/export workflow. These commands are also available under the `sf sync` parent command.\n\n| Command            | Description       |\n| ------------------ | ----------------- |\n| `sf export`        | Export to JSONL   |\n| `sf import`        | Import from JSONL |\n| `sf status`        | Show sync status  |\n| `sf sync export`   | Export to JSONL (alias)   |\n| `sf sync import`   | Import from JSONL (alias) |\n| `sf sync status`   | Show sync status (alias)  |\n\n#### export\n\n| Option                    | Description                                        |\n| ------------------------- | -------------------------------------------------- |\n| `-o, --output <dir>`      | Output directory (default: `.stoneforge/sync`)    |\n| `-f, --full`              | Full export (ignore dirty tracking)                |\n| `--include-ephemeral`     | Include ephemeral elements (excluded by default)   |\n\n#### import\n\n| Option                  | Description                                          |\n| ----------------------- | ---------------------------------------------------- |\n| `-i, --input <dir>`     | Input directory (default: `.stoneforge/sync`)        |\n| `-n, --dry-run`         | Show what would be imported without making changes   |\n| `-f, --force`           | Force import (remote always wins)                    |\n\n```bash\n# Export dirty elements\nsf export\n\n# Full export\nsf export --full\n\n# Include ephemeral elements\nsf export --include-ephemeral\n\n# Import from default sync directory\nsf import\n\n# Preview import changes\nsf import --dry-run\n\n# Import from specific directory\nsf import --input /path/to/sync\n\n# Force import (remote always wins)\nsf import --force\n```\n\n## External Sync Commands\n\nManage bidirectional synchronization between Stoneforge and external services (GitHub Issues, Linear, Notion, Folder, etc.).\n\n**Source:** `packages/quarry/src/cli/commands/external-sync.ts`\n\n**Supported providers:** `github`, `linear`, `notion`, `folder`\n\n| Command                                                        | Description                  |\n| -------------------------------------------------------------- | ---------------------------- |\n| `sf external-sync config`                                      | Show provider configuration  |\n| `sf external-sync config set-token <provider> <token>`         | Store auth token             |\n| `sf external-sync config set-project <provider> <project>`     | Set default project          |\n| `sf external-sync config set-auto-link <provider> [--type]`     | Enable auto-link with a provider |\n| `sf external-sync config disable-auto-link [--type]`           | Disable auto-link            |\n| `sf external-sync link <elementId> <url-or-id>`                | Link element to external resource |\n| `sf external-sync link-all --provider <provider> [options]`    | Bulk-link all unlinked elements |\n| `sf external-sync unlink <elementId>`                          | Remove external link         |\n| `sf external-sync push [elementId...]`                         | Push linked element(s)       |\n| `sf external-sync push --all`                                  | Push all linked elements     |\n| `sf external-sync push --all --force`                          | Force-push all (skip hash check) |\n| `sf external-sync pull`                                        | Pull changes from external   |\n| `sf external-sync sync [--dry-run]`                            | Bidirectional sync           |\n| `sf external-sync status`                                      | Show sync state              |\n| `sf external-sync resolve <elementId> --keep local\\|remote`    | Resolve sync conflict        |\n\n```bash\n# Configure a provider\nsf external-sync config set-token github ghp_xxxxxxxxxxxx\nsf external-sync config set-project github my-org/my-repo\nsf external-sync config set-token notion ntn_xxxxxxxxxxxx\nsf external-sync config set-auto-link github\nsf external-sync config set-auto-link --type document folder\nsf external-sync config disable-auto-link\nsf external-sync config disable-auto-link --type document\nsf external-sync config disable-auto-link --type task\n\n# Link a task to an external issue\nsf external-sync link el-abc123 https://github.com/org/repo/issues/42\nsf external-sync link el-abc123 42\n\n# Link a document to an external page\nsf external-sync link el-doc456 page-id-123 --type document --provider notion\n\n# Bulk-link all unlinked tasks\nsf external-sync link-all --provider github\nsf external-sync link-all --provider github --dry-run\n\n# Bulk-link all unlinked documents\nsf external-sync link-all --provider notion --type document\nsf external-sync link-all --provider folder --type document\n\n# Push/pull/sync (all types)\nsf external-sync push el-abc123\nsf external-sync push --all\nsf external-sync pull\nsf external-sync sync --dry-run\n\n# Push/pull/sync only tasks or documents\nsf external-sync push --all --type task\nsf external-sync pull --type document\nsf external-sync sync --type task\n\n# Check status and resolve conflicts\nsf external-sync status\nsf external-sync resolve el-abc123 --keep local\n```\n\n#### external-sync config\n\nShow current external sync provider configuration. Displays enabled status, conflict strategy, default direction, poll interval, and configured providers. Tokens are masked in output for security.\n\n```bash\nsf external-sync config\nsf external-sync config --json\n```\n\n#### external-sync config set-token\n\nStore an authentication token for an external sync provider. The token is stored in the local SQLite database (not git-tracked).\n\n| Argument   | Description                                |\n| ---------- | ------------------------------------------ |\n| `provider` | Provider name (e.g., `github`, `linear`)   |\n| `token`    | Authentication token                       |\n\n```bash\nsf external-sync config set-token github ghp_xxxxxxxxxxxx\nsf external-sync config set-token linear lin_api_xxxxxxxxxxxx\nsf external-sync config set-token notion ntn_xxxxxxxxxxxx\n```\n\n#### external-sync config set-project\n\nSet the default project (e.g., `owner/repo`) for an external sync provider. This is used when linking tasks with bare issue numbers instead of full URLs.\n\n| Argument   | Description                                           |\n| ---------- | ----------------------------------------------------- |\n| `provider` | Provider name (e.g., `github`, `linear`)              |\n| `project`  | Project identifier (e.g., `owner/repo` for GitHub)    |\n\n```bash\nsf external-sync config set-project github my-org/my-repo\nsf external-sync config set-project linear MY-PROJECT\n```\n\n#### external-sync config set-auto-link\n\nEnable auto-link for new elements with the specified provider. When auto-link is enabled, newly created elements will automatically get a corresponding external issue or page created and linked.\n\nUse `--type task` (default) to configure auto-link for tasks. Use `--type document` to configure a separate auto-link provider for documents.\n\n| Argument   | Description                                              |\n| ---------- | -------------------------------------------------------- |\n| `provider` | Provider name (`github`, `linear`, `notion`, or `folder`) |\n\n| Option              | Description                                           |\n| ------------------- | ----------------------------------------------------- |\n| `-t, --type <type>` | Type of auto-link: `task` or `document` (default: `task`) |\n\n```bash\nsf external-sync config set-auto-link github\nsf external-sync config set-auto-link linear\nsf external-sync config set-auto-link --type document folder\nsf external-sync config set-auto-link --type document notion\n```\n\n#### external-sync config disable-auto-link\n\nDisable auto-link for elements. Use `--type` to control which auto-link to disable.\n\n| Option              | Description                                                    |\n| ------------------- | -------------------------------------------------------------- |\n| `-t, --type <type>` | Type of auto-link to disable: `task`, `document`, or `all` (default: `all`) |\n\n```bash\nsf external-sync config disable-auto-link                # Disable all\nsf external-sync config disable-auto-link --type task     # Only disable tasks\nsf external-sync config disable-auto-link --type document # Only disable documents\n```\n\n#### external-sync link\n\nLink a Stoneforge element (task or document) to an external resource. Sets the element's `externalRef` and `_externalSync` metadata. For tasks, if given a bare issue number, constructs the URL from the provider's default project. For documents, supply the external page/resource ID directly.\n\n| Argument          | Description                                      |\n| ----------------- | ------------------------------------------------ |\n| `elementId`       | Stoneforge element ID (task or document)         |\n| `url-or-id`       | Full URL, bare issue number, or external page ID |\n\n| Option                  | Description                                           |\n| ----------------------- | ----------------------------------------------------- |\n| `-p, --provider <name>` | Provider name (default: `github`)                    |\n| `-t, --type <type>`     | Element type: `task` or `document` (default: `task`) |\n\n```bash\n# Link a task\nsf external-sync link el-abc123 https://github.com/org/repo/issues/42\nsf external-sync link el-abc123 42\nsf external-sync link el-abc123 42 --provider github\n\n# Link a document\nsf external-sync link el-doc456 page-id-123 --type document --provider notion\nsf external-sync link el-doc456 /path/to/file.md --type document --provider folder\n```\n\n#### external-sync link-all\n\nBulk-link all unlinked elements to external resources. By default links tasks; use `--type document` to link documents instead. Finds all elements of the specified type that do not have external sync metadata and creates a corresponding external resource for each one, then links them. If a rate limit is hit, the command stops gracefully and reports how many elements were linked — re-run the command to continue.\n\nWhen linking documents (`--type document`), system-managed categories (e.g., `task-description`, `message-content`) are automatically excluded.\n\n| Option                    | Description                                                  |\n| ------------------------- | ------------------------------------------------------------ |\n| `-p, --provider <name>`   | Provider to link to (required)                               |\n| `--project <project>`     | Override the default project                                 |\n| `-t, --type <type>`       | Element type: `task` or `document` (default: `task`)         |\n| `-s, --status <status>`   | Only link tasks with this status (repeatable, task type only)|\n| `-n, --dry-run`           | List elements that would be linked without creating them     |\n| `-b, --batch-size <n>`    | How many elements to process concurrently (default: `10`)    |\n| `-f, --force`             | Re-link elements already linked to a different provider      |\n\n```bash\n# Bulk-link tasks\nsf external-sync link-all --provider github\nsf external-sync link-all --provider github --project my-org/my-repo\nsf external-sync link-all --provider github --status active --status blocked\nsf external-sync link-all --provider github --dry-run\nsf external-sync link-all --provider github --batch-size 5\nsf external-sync link-all --provider linear --force\n\n# Bulk-link documents\nsf external-sync link-all --provider notion --type document\nsf external-sync link-all --provider folder --type document --dry-run\nsf ex\n","version":29,"previousVersionId":"el-59tr","category":"reference","status":"active","immutable":false}
